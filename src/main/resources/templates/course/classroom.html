<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${currentLesson.title} + ' | ' + ${course.title}">Lesson | DevForge</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

    <style>
        body { overflow-x: hidden; }
        .sidebar { height: 100vh; overflow-y: auto; border-right: 1px solid #dee2e6; }
        .lesson-item { cursor: pointer; transition: 0.2s; text-decoration: none; display: block; padding: 10px 15px;}
        .lesson-item:hover { background-color: #f8f9fa; }
        .lesson-item.active { background-color: #e9ecef; border-left: 4px solid #0d6efd; font-weight: bold; color: #000; }
        .content-area { padding: 40px; }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; margin-bottom: 20px; border-radius: 8px;}
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .lesson-content img { max-width: 100%; height: auto; border-radius: 5px; margin: 10px 0; }
        .lesson-content pre { border-radius: 6px; }
        .lesson-content h2 { margin-top: 1.5rem; }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        
        <!-- Sidebar: Curriculum -->
        <div class="col-md-3 p-0 sidebar bg-white">
            <div class="p-3 border-bottom bg-light">
                <a href="/my-learning" class="text-decoration-none text-secondary mb-2 d-block">&larr; Back to Dashboard</a>
                <h5 class="m-0 text-truncate" th:text="${course.title}">Course Name</h5>
            </div>
            
            <div class="list-group list-group-flush">
                <a th:each="lesson, iter : ${lessons}"
                   th:href="@{/learn/{cid}/lecture/{lid}(cid=${course.id}, lid=${lesson.id})}"
                   class="lesson-item border-bottom"
                   th:classappend="${lesson.id == currentLesson.id} ? 'active' : ''">
                   <div>
                        <small class="text-muted me-2" th:text="${iter.count} + '.'">1.</small>
                        <span th:text="${lesson.title}">Lesson Title</span>
                   </div>
                    <span th:if="${#lists.contains(completedLessonIds, lesson.id)}" class="text-success">‚úî</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9 content-area">
            
            <!-- Header -->
            <div class="d-flex gap-2">
                <!-- Previoud -->
                <a th:if="${prevLessonId}" th:href="@{/learn/{cid}/lecture/{lid}(cid=${course.id}, lid=${prevLessonId})}" 
                class="btn btn-outline-secondary">Previous</a>
                
                <!-- Complete lesson form -->
                <form th:action="@{/learn/{cid}/lecture/{lid}/complete(cid=${course.id}, lid=${currentLesson.id})}" method="post">
                    
                    <!-- If there another lessons -->
                    <button th:if="${nextLessonId}" type="submit" class="btn btn-primary">
                        Mark as Completed & Next &rarr;
                    </button>
                    
                    <!-- If it is last lesson -->
                    <button th:unless="${nextLessonId}" type="submit" class="btn btn-success">
                        Finish Course üèÜ
                    </button>
                </form>
            </div>

            <!-- Video Player (Optional) -->
            <div th:if="${currentLesson.videoUrl != null and !currentLesson.videoUrl.isEmpty()}" class="video-container shadow-sm">
                <!-- Simple logic to support YouTube embeds if user pastes full URL -->
                <!-- Ideally use a helper to extract ID, but for MVP we assume user puts embed URL or we trust raw URL -->
                <iframe th:src="${currentLesson.videoUrl}" 
                        title="Lesson Video" frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen></iframe>
            </div>

            <!-- Text Content -->
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <!-- th:utext is dangerous for XSS, but for Teacher content (Trusted) it allows HTML formatting -->
                    <div th:utext="${htmlContent}">
                        Lesson content...
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
</body>
</html>